<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./css/edit.css" />
    <link rel="stylesheet" href="editor.md/css/editormd.min.css" />
    <link rel="stylesheet" href="./css/common.css" />
    <link rel="stylesheet" href="./dist/css/jquery.toast.css" />
    <link rel="icon" href="./img/logo.png" type="image/x-icon" />
    <title>å‘å¸ƒç­çº§é€šçŸ¥</title>
</head>
<body>
<div class="navigation">
    <!-- å¤´åƒ -->
    <img src="./img/logo.png" />
    <div class="title">å‘å¸ƒç­çº§é€šçŸ¥ï¼ˆ<span id="creator"></span> ğŸ‘‰ <span id="className"></span>ï¼‰</div>
    <div class="space"></div>
    <a href="./my_class_list.html">æˆ‘çš„ç­çº§</a>
    <a href="./class_list.html">ç­çº§åˆ—è¡¨</a>
    <a href="./class_message_list.html">ç­çº§æ¶ˆæ¯</a>
    <a href="./site_message_list.html">ç«™å†…ä¿¡</a>
    <a href="./system_message_list.html">ç³»ç»Ÿæ¶ˆæ¯</a>
    <a href="./login.html">ç™»å½•</a>
</div>
<div class="blog-edit-container">
    <!-- æ ‡é¢˜ç¼–è¾‘åŒº -->
    <div id="form">
        <div class="title">
            <input type="text" id="text" name="title" />
            <input type="button" id="submit" value="æäº¤" onclick="publish()" />
        </div>
        <!-- åˆ›å»ºä¸€ä¸ªidä¸ºeditorçš„div idï¼-->
        <div id="editor">
          <textarea
                  id="content"
                  name="content"
                  style="display: none"
          ></textarea>
        </div>
    </div>
</div>
<script src="./dist/js/jquery-3.6.3.js"></script>
<script src="./dist/js/jquery.cookie.js"></script>
<script src="./dist/js/jquery.toast.js"></script>
<script src="./js/urlHandler.js"></script>
<script src="./js/redirect.js"></script>
<script src="./js/token.js"></script>
<script src="./js/request.js"></script>
<script src="./js/userType.js"></script>
<script src="editor.md/lib/marked.min.js"></script>
<script src="editor.md/lib/prettify.min.js"></script>
<script src="editor.md/editormd.js"></script>

<script>
    // editormdå‡½æ•°æ„é€ ç¼–è¾‘å™¨å¯¹è±¡ï¼Œå‚æ•°åˆ™æ˜¯ç¼–è¾‘å™¨å…ƒç´ çš„idï¼Œä»¥åŠjså¯¹è±¡ï¼Œåˆå§‹åŒ–é‡
    // è¿™ä¸€æ­¥é‡ç‚¹åœ¨äºé»˜é»˜å¸®ä½ æ„å»ºäº†å¯¹è±¡ï¼
    //å…¶ä»–å±æ€§åœ¨è¿™é‡Œè®¾ç½®å°±è¡Œäº†ï¼Œå› ä¸ºè¿™é‡Œçš„ä¼˜å…ˆçº§ä¼šæ›´é«˜ï¼
    //ç”±äºä¸èƒ½æœ‰-å·ï¼Œæ‰€ä»¥åœ†è§’çŸ©å½¢ä¸èƒ½åœ¨è¿™é‡Œè®¾ç½®
    // è¿™ä¸ªæ„é€ å™¨ï¼Œé»˜è®¤ä¼šæº¢å‡ºå°†æ»šåŠ¨æ¡ç»™markdownç¼–è¾‘å™¨ï¼
    var editor = editormd("editor", {
        width: "100%",
        height: "calc(100% - 50px)",
        markdown: "# Hello",
        path: "editor.md/lib/",
        saveHTMLToTextarea: true,
    });
    jsonRequestWithToken("/api/v1/user/info", "GET", null, function (data) {
        jQuery("#creator").html(data.nickname);
    });
    jsonRequestWithToken("/api/v1/class/query/users/" + getParamValue("classId"), "GET", null, function (data) {
        jQuery("#className").html(data.className);
    });

    function publish() {
        jsonRequestWithToken("/api/v1/message/class/release", "POST", {
            classId: getParamValue("classId"),
            title: jQuery("#text").val(),
            content: jQuery("#content").val(),
        }, function (data) {
            jQuery.toast({
                heading: "æˆåŠŸ",
                text: "å‘å¸ƒæˆåŠŸ",
                icon: "success",
                allowToastClose: true,
            });
            toClassMessageDetail(data);
        })
    }
</script>
</body>
</html>
