<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>所有人的博客列表</title>
    <link rel="stylesheet" href="css/common.css" />
    <link rel="stylesheet" href="css/list.css" />
    <script src="js/url_handler.js"></script>
    <!-- 引入jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <link rel="icon" href="img/logo1.png" type="image/x-icon" />
    <style>
      .blog-pagnation-wrapper {
        background-color: rgba(255, 255, 255, 0.8);
        height: 40px;
        margin: 16px 0;
        border-radius: 5px;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .blog-pagnation-item {
        display: inline-block;
        padding: 8px;
        border: 1px solid #d0d0d5;
        color: #333;
      }
      .blog-pagnation-item:hover {
        background: rgb(252, 133, 167);
        color: #fff;
      }
      .blog-pagnation-item.actvie {
        background: rgb(252, 133, 167);
        color: #fff;
      }
    </style>
  </head>
  <body>
    <div class="navigation">
      <!-- 头像 -->
      <img src="img/logo1.png" />
      <div class="title">我的博客系统</div>

      <div class="space"></div>

      <a id="mine" href="myblog_lists.html">我的博客</a>
      <a id="add" href="blog_add.html">写博客</a>
      <a id="logout" href="/user/logout">退出登录</a>
    </div>

    <!-- 页面主体 -->
    <div class="container">
      <div class="container-right" style="width: 100%">
        <div class="article" style="height: 90%">
          <!-- <div class="blog">
            <div class="thing">
              <img src="img/avatar.png" />
              <div class="title">xxx</div>
            </div>
            <div class="date">xxx 阅读量：xxx</div>
            <div class="content">xxx</div>
            <a href="#">查看正文</a>
          </div>
         -->
        </div>
        <div class="blog-pagnation-wrapper">
          <button class="blog-pagnation-item" onclick="tofirst()">首页</button>
          <button class="blog-pagnation-item" onclick="toPrev()">上一页</button>
          <button class="blog-pagnation-item" onclick="toNext()">下一页</button>
          <button class="blog-pagnation-item" onclick="toLast()">末页</button>
          <div id="tip"></div>
          <input id="pmax" type="text" style="display: none" />
        </div>
      </div>
    </div>

    <script>
      var psize = 2;
      var pindex = 1;

      // 初始化数据
      function init() {
        // 1. 得到url的分页相关的参数
        psize = getParamValue("psize");
        pindex = getParamValue("pindex");
        if (psize == null || parseInt(psize) == NaN || psize < 2) {
          psize = 2;
        }
        if (pindex == null || parseInt(pindex) == NaN || pindex < 1) {
          pindex = 1;
        }
        // 2. 发送请求（psize pindex）
        jQuery.ajax({
          url: "/art/all_list?psize=" + psize + "&pindex=" + pindex,
          method: "get",
          success: function (body) {
            if (body.code == 200) {
              // 3. 导航栏显示
              if (body.data.login == false) {
                jQuery("#icon").attr("href", "img/logo2.png");
                jQuery(".navigation img").attr("src", " img/logo2.png");
                jQuery(".navigation .space").css("width", "75%");
                jQuery(".title").text("未登录");
                jQuery("#mine").hide();
                jQuery("#add").hide();
                jQuery("#logout").text("登录");
                jQuery("#logout").attr("href", "blog_login.html");
              }
              // 4. 显示文章，构造博客html元素

              if (body.data.list.length == 0) {
                jQuery(".article").append(
                  jQuery('<h1 style="color: slateblue">暂无文章</h1>')
                );
                jQuery("#tip").text(
                  "（当前在第 " + 0 + " 页，共 " + 0 + " 页）"
                ); //一页为0，只有在没有一条数据的时候才会出现！
                return 0;
              }
              jQuery("#tip").text(
                "（当前在第 " + pindex + " 页，共 " + body.data.pMax + " 页）"
              );
              jQuery("#pmax").val(body.data.pMax);
              for (var blog of body.data.list) {
                var art = '<div class="blog">';
                art += '<div class="thing">';
                art += '<img src="' + blog.photo + '"/>';
                art += '<div class="title">' + blog.title + "</div></div>";
                art +=
                  '<div class="date">' +
                  blog.createtime +
                  " 阅读量：" +
                  blog.rcount +
                  "</div>";
                art += '<div class="content">' + blog.summary + "</div>";
                art +=
                  '<a href="blog_detail.html?aid=' + blog.id + '">查看正文</a>';

                art += "</div>";
                jQuery(".article").append(jQuery(art));
              }
            } else if (body.code == -2) {
              alert(body.msg);
              location.href = "blog_lists.html?pindex=1&psize=" + psize;
            } else {
              alert("查看失败：" + body.msg);
            }
          },
        });
      }
      init();
      function tofirst() {
        if (pindex == 1) {
          alert("已在首页！");
          location.href = location.href;
        } else {
          location.href = "blog_lists.html?pindex=1&psize=" + psize;
        }
      }
      function toLast() {
        if (pindex == jQuery("#pmax").val()) {
          alert("已在末页！");
          location.href = location.href;
        } else {
          location.href =
            "blog_lists.html?pindex=" +
            jQuery("#pmax").val() +
            "&psize=" +
            psize;
        }
      }
      function toPrev() {
        if (pindex <= 1) {
          alert("已在首页!");
          location.href = location.href;
        } else {
          location.href =
            "blog_lists.html?pindex=" +
            (parseInt(pindex) - 1) +
            "&psize=" +
            psize;
        }
      }
      function toNext() {
        if (pindex >= jQuery("#pmax").val()) {
          alert("已在末页!");
          location.href = location.href;
        } else {
          location.href =
            "blog_lists.html?pindex=" +
            (parseInt(pindex) + 1) +
            "&psize=" +
            psize;
        }
      }
    </script>
  </body>
</html>
